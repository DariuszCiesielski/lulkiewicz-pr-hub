---
phase: 01-hub-shell-fundament
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - next.config.ts
  - tailwind.config.ts
  - postcss.config.mjs
  - src/app/layout.tsx
  - src/app/globals.css
  - src/app/page.tsx
  - src/app/(auth)/login/page.tsx
  - src/app/(auth)/register/page.tsx
  - src/app/(auth)/layout.tsx
  - src/app/(hub)/layout.tsx
  - src/app/(hub)/dashboard/page.tsx
  - src/lib/supabase/client.ts
  - src/lib/supabase/server.ts
  - src/lib/supabase/middleware.ts
  - src/middleware.ts
  - src/contexts/AuthContext.tsx
  - src/types/index.ts
  - .env.local.example
autonomous: true

must_haves:
  truths:
    - "Uzytkownik moze sie zarejestrowac (email + haslo) i zalogowac"
    - "Sesja utrzymuje sie po odswiezeniu przegladarki"
    - "Niezalogowany uzytkownik jest automatycznie przekierowany na /login"
    - "Zalogowany uzytkownik widzi strone /dashboard (nawet pusta)"
  artifacts:
    - path: "src/app/(auth)/login/page.tsx"
      provides: "Strona logowania z formularzem email+haslo"
      min_lines: 40
    - path: "src/app/(auth)/register/page.tsx"
      provides: "Strona rejestracji z formularzem email+haslo"
      min_lines: 40
    - path: "src/middleware.ts"
      provides: "Middleware chroniacy (hub) routes przed niezalogowanymi"
      min_lines: 15
    - path: "src/lib/supabase/client.ts"
      provides: "Supabase browser client"
      exports: ["createBrowserClient"]
    - path: "src/lib/supabase/server.ts"
      provides: "Supabase server client"
      exports: ["createServerClient"]
    - path: "src/contexts/AuthContext.tsx"
      provides: "AuthProvider z sesja, user, signOut"
      exports: ["AuthProvider", "useAuth"]
  key_links:
    - from: "src/middleware.ts"
      to: "src/lib/supabase/middleware.ts"
      via: "Supabase middleware helper"
      pattern: "updateSession"
    - from: "src/app/(auth)/login/page.tsx"
      to: "src/lib/supabase/client.ts"
      via: "signInWithPassword"
      pattern: "supabase\\.auth\\.signInWithPassword"
    - from: "src/app/(hub)/layout.tsx"
      to: "src/contexts/AuthContext.tsx"
      via: "AuthProvider wrapper"
      pattern: "AuthProvider"
---

<objective>
Scaffold projektu Next.js z Supabase Auth -- rejestracja, logowanie, sesja, protected routes.

Purpose: To jest fundament calej aplikacji. Bez dzialajacego auth i scaffoldu nic innego nie moze byc budowane.
Output: Dzialajaca aplikacja Next.js z logowaniem, rejestracja, sesja utrzymujaca sie po refreshu, middleware chroniacy /dashboard przed niezalogowanymi.
</objective>

<execution_context>
@C:\Users\dariu\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\dariu\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@C:\Users\dariu\Documents\Cursor projects\Lulkiewicz PR Hub\.planning\PROJECT.md
@C:\Users\dariu\Documents\Cursor projects\Lulkiewicz PR Hub\.planning\ROADMAP.md
@C:\Users\dariu\Documents\Cursor projects\Lulkiewicz PR Hub\.planning\STATE.md

Globalne skille (adaptuj do Next.js App Router, NIE kopiuj 1:1):
@C:\Users\dariu\.claude\skills\supabase-auth-rls\SKILL.md
@C:\Users\dariu\.claude\skills\unified-design-system\SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Next.js + konfiguracja + Supabase clients</name>
  <files>
    package.json
    tsconfig.json
    next.config.ts
    tailwind.config.ts
    postcss.config.mjs
    src/app/layout.tsx
    src/app/globals.css
    src/app/page.tsx
    src/lib/supabase/client.ts
    src/lib/supabase/server.ts
    src/lib/supabase/middleware.ts
    src/types/index.ts
    .env.local.example
  </files>
  <action>
    0. NAJPIERW utworz projekt Supabase (EU region — GDPR wymaganie):
       - Uzyj Supabase Management API (CLI broken):
       ```bash
       curl -X POST "https://api.supabase.com/v1/projects" \
         -H "Authorization: Bearer {SUPABASE_ACCESS_TOKEN}" \
         -H "Content-Type: application/json" \
         -d '{
           "name": "lulkiewicz-pr-hub",
           "organization_id": "{SUPABASE_ORG_ID}",
           "region": "eu-central-1",
           "plan": "free",
           "db_pass": "WYGENERUJ_SILNE_HASLO_MIN_16_ZNAKOW"
         }'
       ```
       - Poczekaj na odpowiedz — zawiera `id` (project ref), endpoint URL, klucze API
       - Jesli MCP Supabase jest dostepny, uzyj go zamiast curl
       - Z odpowiedzi pobierz:
         - `NEXT_PUBLIC_SUPABASE_URL` = `https://{ref}.supabase.co`
         - `NEXT_PUBLIC_SUPABASE_ANON_KEY` = anon key z API keys
         - `SUPABASE_SERVICE_ROLE_KEY` = service_role key z API keys
       - Zapisz te wartosci do `.env.local` (plik NIE commitowany do repo)
       - Zweryfikuj ze projekt dziala: `curl https://{ref}.supabase.co/rest/v1/ -H "apikey: {ANON_KEY}"` — powinno zwrocic 200

       WAZNE: Access token i org ID pobierz z konta Supabase uzytkownika.
       NIE hardcoduj — zapytaj uzytkownika jesli potrzeba.
       Region MUSI byc `eu-central-1` (Frankfurt) — wymaganie GDPR.

    1. Zainicjuj projekt Next.js 15+ (App Router) z TypeScript i Tailwind CSS:
       - `npx create-next-app@latest . --typescript --tailwind --eslint --app --src-dir --import-alias "@/*" --no-turbopack`
       - Jesli katalog nie jest pusty, uzyj flagi odpowiedniej do nadpisania (--yes)

    2. Zainstaluj zaleznosci:
       - `npm install @supabase/supabase-js @supabase/ssr`
       - `npm install lucide-react`
       - Pozniej (plan 01-03) shadcn/ui -- tu jeszcze nie

    3. Utworz klienty Supabase (wzorzec @supabase/ssr dla Next.js App Router):
       - `src/lib/supabase/client.ts` — browser client (createBrowserClient z @supabase/ssr)
       - `src/lib/supabase/server.ts` — server client (createServerClient z @supabase/ssr, cookies)
       - `src/lib/supabase/middleware.ts` — middleware helper (updateSession)
       - Uzyj `process.env.NEXT_PUBLIC_SUPABASE_URL` i `process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY`

    4. Utworz `.env.local.example` z wymaganymi zmiennymi:
       ```
       NEXT_PUBLIC_SUPABASE_URL=
       NEXT_PUBLIC_SUPABASE_ANON_KEY=
       SUPABASE_SERVICE_ROLE_KEY=
       ```

    5. Utworz `src/types/index.ts` z podstawowymi typami:
       ```typescript
       export type UserRole = 'admin' | 'user';
       export type ToolId = 'email-analyzer' | 'tool-2' | 'tool-3' | 'tool-4' | 'tool-5' | 'tool-6';
       ```

    6. W `src/app/globals.css` — przygotuj bazowy reset Tailwind + zmienna na font DM Sans (Google Fonts):
       - Dodaj `@import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap');`
       - body: font-family DM Sans

    7. W `src/app/layout.tsx` — podstawowy layout z metadata (title: "Lulkiewicz PR Hub", lang: "pl")

    8. W `src/app/page.tsx` — redirect na /login (tymczasowy root redirect)

    WAZNE:
    - NIE uzywaj react-router-dom — to Next.js App Router
    - NIE uzywaj import.meta.env — to Next.js, uzyj process.env
    - Jezyk UI: TYLKO polski
    - Supabase client pattern: @supabase/ssr (NIE stary @supabase/auth-helpers-nextjs)
  </action>
  <verify>
    - Projekt Supabase istnieje i odpowiada: `curl https://{ref}.supabase.co/rest/v1/ -H "apikey: {ANON_KEY}"` zwraca 200
    - `.env.local` zawiera NEXT_PUBLIC_SUPABASE_URL, NEXT_PUBLIC_SUPABASE_ANON_KEY, SUPABASE_SERVICE_ROLE_KEY (wszystkie niepuste)
    - `npm run build` kompiluje sie bez bledow
    - `npm run dev` startuje na localhost:3000
    - Pliki `src/lib/supabase/client.ts`, `server.ts`, `middleware.ts` istnieja
    - `src/types/index.ts` eksportuje UserRole i ToolId
  </verify>
  <done>
    Projekt Supabase utworzony (EU Frankfurt), klucze w .env.local, Next.js zainicjowany, Tailwind dziala, klienty Supabase gotowe, typy zdefiniowane, `npm run build` przechodzi.
  </done>
</task>

<task type="auto">
  <name>Task 2: Auth flow — login, register, middleware, AuthContext</name>
  <files>
    src/app/(auth)/layout.tsx
    src/app/(auth)/login/page.tsx
    src/app/(auth)/register/page.tsx
    src/app/(hub)/layout.tsx
    src/app/(hub)/dashboard/page.tsx
    src/middleware.ts
    src/contexts/AuthContext.tsx
  </files>
  <action>
    1. Utworz `src/middleware.ts`:
       - Importuj updateSession z `@/lib/supabase/middleware`
       - Matcher: `/((?!_next/static|_next/image|favicon.ico|.*\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)`
       - Logika: odswiezona sesja + redirect niezalogowanych na /login (jesli request path zaczyna sie od sciezek chronionych jak /dashboard, /admin, /settings itd.)
       - Zalogowani na /login lub /register -> redirect na /dashboard

    2. Utworz `src/contexts/AuthContext.tsx` (client component "use client"):
       - AuthProvider z useState: session, user, userRole, isLoading
       - useEffect: getSession() + onAuthStateChange listener
       - signOut function
       - canAccessTool(toolId) — admin ma pelny dostep, user sprawdza allowed_tools
       - Eksportuj useAuth() hook
       - Na razie userRole i allowed_tools beda null/[] do momentu kiedy tabela Supabase bedzie gotowa (plan 01-02)
       - Wzorzec z globalnego skill user-management-system, ale zaadaptowany do Next.js (createBrowserClient)

    3. Utworz `src/app/(auth)/layout.tsx`:
       - Prosty centered layout (flex items-center justify-center min-h-screen)
       - Tlo: ciemne (bg-slate-900 lub CSS var)
       - Brak sidebar, brak header — czysty auth layout

    4. Utworz `src/app/(auth)/login/page.tsx` (client component):
       - Formularz: email + haslo + przycisk "Zaloguj sie"
       - Link do /register "Nie masz konta? Zarejestruj sie"
       - Po udanym logowaniu: router.push('/dashboard')
       - Obsluga bledow: wyswietl komunikat pod formularzem
       - Styl: karta na ciemnym tle, jasny formularz (wzorzec "jasna wyspa")
       - Logo/tytul: "Lulkiewicz PR Hub" nad formularzem
       - Jezyk: TYLKO polski

    5. Utworz `src/app/(auth)/register/page.tsx` (client component):
       - Formularz: email + haslo + potwierdzenie hasla + przycisk "Zarejestruj sie"
       - Walidacja: haslo min 6 znakow, hasla musza sie zgadzac
       - Link do /login "Masz juz konto? Zaloguj sie"
       - Po rejestracji: komunikat "Sprawdz email aby potwierdzic konto" LUB redirect na /dashboard (zalezne od konfiguracji Supabase)
       - Styl: taki sam jak login

    6. Utworz `src/app/(hub)/layout.tsx`:
       - Opakuj children w AuthProvider
       - Na razie prosty layout: header placeholder + main z children
       - Przekaz children do main content area

    7. Utworz `src/app/(hub)/dashboard/page.tsx`:
       - Tymczasowa strona: "Witaj w Lulkiewicz PR Hub" + przycisk wyloguj
       - Uzyj useAuth() do pobrania user.email i signOut

    WAZNE:
    - Strony auth (login/register) to client components ("use client") bo uzywaja useState/useEffect
    - Middleware MUSI odswiezac sesje Supabase (updateSession) — bez tego sesja wygasa
    - NIE twórz formularza rejestracji z polem "imie" — tylko email + haslo (proste)
    - Supabase signUp moze wymagac email confirmation — obsluż oba scenariusze
  </action>
  <verify>
    - `npm run build` przechodzi bez bledow
    - Otworz localhost:3000 — redirect na /login
    - Formularz logowania renderuje sie poprawnie
    - Formularz rejestracji renderuje sie poprawnie
    - Po zalogowaniu (jesli Supabase skonfigurowany) — redirect na /dashboard
    - Po wylogowaniu — redirect na /login
    - Odswiezenie strony /dashboard nie wylogowuje (sesja utrzymuje sie)
  </verify>
  <done>
    Login i rejestracja dzialaja, middleware chroni /dashboard przed niezalogowanymi, sesja utrzymuje sie po refreshu przegladarki. Requirements HUB-01, HUB-02, HUB-03 spelnione.
  </done>
</task>

</tasks>

<verification>
- `npm run build` — brak bledow kompilacji
- Odwiedzenie / -> redirect na /login
- Odwiedzenie /dashboard bez sesji -> redirect na /login
- Formularz /login renderuje sie z polami email, haslo, przyciskiem
- Formularz /register renderuje sie z polami email, haslo, potwierdzenie, przyciskiem
- AuthContext dostepny w (hub) layoutcie
</verification>

<success_criteria>
1. `npm run build` przechodzi bez bledow
2. Middleware redirectuje niezalogowanych na /login
3. Middleware redirectuje zalogowanych z /login na /dashboard
4. Formularze auth sa po polsku z obsluga bledow
5. AuthContext eksportuje useAuth() z session, user, signOut
6. Sesja Supabase odswiezana w middleware (nie wygasa)
</success_criteria>

<output>
Po zakonczeniu utworz `.planning/phases/01-hub-shell-fundament/01-01-SUMMARY.md`
</output>
