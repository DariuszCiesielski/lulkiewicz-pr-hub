---
phase: 08-group-management
plan: 03
type: execute
wave: 3
depends_on: ["08-02"]
files_modified:
  - src/app/(hub)/fb-analyzer/groups/page.tsx
  - src/components/fb/GroupTable.tsx
  - src/components/fb/GroupFormModal.tsx
  - src/components/fb/GroupBulkUpload.tsx
  - src/components/fb/BulkActionToolbar.tsx
autonomous: true

must_haves:
  truths:
    - "Admin widzi tabele grup pogrupowana w sekcje per deweloper z metadanymi (status, posty, ostatni scrape)"
    - "Admin moze dodac grupe przez formularz (nazwa, URL, deweloper, instrukcja AI)"
    - "Admin moze dodac wiele grup naraz przez upload pliku z URL-ami"
    - "Admin moze edytowac grupe w modalu i soft-deletowac z potwierdzeniem"
    - "Admin moze przelaczac status (active/paused) jednym klikiem"
    - "Admin moze zaznaczac grupy checkboxami i wykonywac bulk operacje (zmien status, usun, przypisz dewelopera)"
    - "Wstrzymane grupy sa wizualnie oznaczone (inna kolorystyka/ikona)"
  artifacts:
    - path: "src/app/(hub)/fb-analyzer/groups/page.tsx"
      provides: "Strona zarzadzania grupami FB (zastepuje shell)"
      min_lines: 80
    - path: "src/components/fb/GroupTable.tsx"
      provides: "Tabela grup z sekcjami per deweloper, checkboxy, akcje per wiersz"
      min_lines: 120
    - path: "src/components/fb/GroupFormModal.tsx"
      provides: "Modal dodawania/edycji grupy"
      min_lines: 100
    - path: "src/components/fb/GroupBulkUpload.tsx"
      provides: "Komponent uploadu pliku z URL-ami"
      min_lines: 60
    - path: "src/components/fb/BulkActionToolbar.tsx"
      provides: "Toolbar nad tabela z bulk actions"
      min_lines: 40
  key_links:
    - from: "src/app/(hub)/fb-analyzer/groups/page.tsx"
      to: "/api/fb-groups"
      via: "fetch w useEffect"
      pattern: "fetch.*api/fb-groups"
    - from: "src/components/fb/GroupFormModal.tsx"
      to: "/api/fb-groups"
      via: "fetch POST"
      pattern: "fetch.*api/fb-groups.*POST"
    - from: "src/components/fb/BulkActionToolbar.tsx"
      to: "/api/fb-groups/bulk"
      via: "fetch PATCH"
      pattern: "fetch.*api/fb-groups/bulk"
---

<objective>
Kompletna strona zarzadzania grupami FB z tabela, modalem CRUD, bulk upload i bulk operations. Zastepuje shell page mock data prawdziwym API.

Purpose: To jest glowny interfejs admina do dodawania, edytowania i zarzadzania grupami FB. Spelnia wymagania FBGRP-01, FBGRP-02, FBGRP-03.
Output: 5 komponentow React tworzacych pelny UI zarzadzania grupami.
</objective>

<execution_context>
@C:\Users\dariu\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\dariu\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-group-management/08-CONTEXT.md
@.planning/phases/08-group-management/08-RESEARCH.md
@.planning/phases/08-group-management/08-02-SUMMARY.md
@src/types/fb.ts
@src/app/(hub)/fb-analyzer/groups/page.tsx
@src/components/email/MailboxForm.tsx
@src/components/email/MailboxList.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: GroupTable + GroupFormModal + strona groups</name>
  <files>
    src/components/fb/GroupTable.tsx
    src/components/fb/GroupFormModal.tsx
    src/app/(hub)/fb-analyzer/groups/page.tsx
  </files>
  <action>
**Stworzenie katalogu komponentow:**
Jesli nie istnieje `src/components/fb/`, utworz go.

**1. GroupTable.tsx — Tabela grup z sekcjami per deweloper**

Props:
```typescript
interface GroupTableProps {
  groups: FbGroupEnriched[];
  selectedIds: Set<string>;
  onToggleSelect: (id: string) => void;
  onToggleSelectAll: () => void;
  onEdit: (group: FbGroupEnriched) => void;
  onDelete: (group: FbGroupEnriched) => void;
  onToggleStatus: (group: FbGroupEnriched) => void;
}
```

Implementacja:
- Grupuj grupy per `developer` (null/empty -> sekcja "Bez dewelopera")
- Dla kazdej sekcji: naglowek z nazwa dewelopera + liczba grup
- Tabela HTML `<table>` z CSS variables (NIE bg-white, NIE text-slate)
- Kolumny: checkbox | Nazwa | URL (link zewnetrzny) | Status | Posty | Istotne | Ostatni scrape | Akcje
- Checkbox w naglowku = select all, checkbox per wiersz = select individual
- Status badge: Aktywna (zielony, CheckCircle2) / Wstrzymana (zolty, PauseCircle)
- Przycisk toggle status per wiersz (ikona Play/Pause)
- Przyciski akcji per wiersz: Edytuj (Pencil), Usun (Trash2)
- "Ostatni scrape": formatuj jako "X min/godz/dni temu" lub "Nigdy" (helper timeAgo z istniejacego shell)
- Wstrzymane grupy: caly wiersz z opacity-60 lub subtlnym tlem
- Responsywnosc: na mobile ukryj kolumny URL i Istotne (hidden md:table-cell)
- Stylowanie: `style={{ color: 'var(--text-primary)' }}`, `style={{ backgroundColor: 'var(--bg-secondary)' }}` itd.
- Ikony z lucide-react

**2. GroupFormModal.tsx — Modal dodawania/edycji grupy**

Props:
```typescript
interface GroupFormModalProps {
  group?: FbGroupEnriched | null;  // null = tryb dodawania, object = tryb edycji
  developers: string[];             // lista dla autosuggest
  onSubmit: (data: GroupFormData) => Promise<void>;
  onClose: () => void;
}

interface GroupFormData {
  name: string;
  facebook_url: string;
  developer: string;
  ai_instruction: string;
}
```

Implementacja:
- Wzorzec z MailboxForm: `fixed inset-0 z-50 bg-black/50`, max-w-lg, `style={{ backgroundColor: 'var(--bg-secondary)' }}`
- Tytul: "Dodaj grupe FB" (nowa) lub "Edytuj grupe" (istniejaca)
- 4 pola formularza:
  1. **Nazwa grupy** — text input, required
  2. **URL grupy FB** — text input, required, walidacja client-side (facebook.com/groups/)
  3. **Deweloper** — text input z datalist dla autosuggest (HTML5 `<datalist>` — proste, zero deps)
  4. **Instrukcja AI** — textarea, opcjonalna, placeholder: "Opisz co AI ma szukac w postach tej grupy..."
- Przyciski: Anuluj + Zapisz (disable podczas ladowania)
- Loading state: spinner/disabled podczas POST/PATCH
- Error handling: wyswietl blad z API pod formularzem
- W trybie edycji: pre-fill pola z `group` prop
- Walidacja client-side: nazwa min 2 znaki, URL musi zawierac facebook.com/groups/

**3. groups/page.tsx — Zastapienie shell page**

`'use client'` — calosciowy state management na stronie.

State:
```typescript
const [groups, setGroups] = useState<FbGroupEnriched[]>([]);
const [developers, setDevelopers] = useState<string[]>([]);
const [loading, setLoading] = useState(true);
const [error, setError] = useState<string | null>(null);
const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());
const [showAddModal, setShowAddModal] = useState(false);
const [editingGroup, setEditingGroup] = useState<FbGroupEnriched | null>(null);
const [showBulkUpload, setShowBulkUpload] = useState(false);
const [filterDeveloper, setFilterDeveloper] = useState<string>('');
const [filterStatus, setFilterStatus] = useState<string>('');
```

Fetch logika:
- `useEffect` na mount: `fetch('/api/fb-groups')` + `fetch('/api/fb-groups/developers')` rownolegle (Promise.all)
- Funkcja `refreshGroups()` do ponownego zaladowania po operacjach CRUD
- Filtrowanie: query params `?developer=X&status=Y` LUB filtrowanie client-side (client-side prostsze, mala ilosc danych)

Layout:
- Header: ikona Users + "Grupy FB" + filtry (select developer, select status) + przyciski "Dodaj grupe" i "Upload URL-ow"
- Jesli `selectedIds.size > 0`: pokaz BulkActionToolbar
- GroupTable z danymi
- Modals: GroupFormModal (add/edit), GroupBulkUpload
- Delete confirmation: prosty `confirm()` dialog (nie buduj custom modal — KISS)

Handlery:
- `handleAddGroup`: POST /api/fb-groups, refreshGroups(), zamknij modal
- `handleEditGroup`: PATCH /api/fb-groups/[id], refreshGroups(), zamknij modal
- `handleDeleteGroup`: confirm() + DELETE /api/fb-groups/[id], refreshGroups()
- `handleToggleStatus`: PATCH /api/fb-groups/[id] z `{ status: opposite }`, refreshGroups()
- `handleBulkAction`: PATCH /api/fb-groups/bulk, refreshGroups(), clear selection

Usun import `mockGroups` z `@/lib/mock/fb-mock-data` — shell page go uzywa, ale teraz pobieramy z API.
  </action>
  <verify>
`npx tsc --noEmit` — zero bledow. Sprawdz ze:
- groups/page.tsx NIE importuje mockGroups
- groups/page.tsx fetchuje z /api/fb-groups
- GroupTable renderuje sekcje per deweloper
- GroupFormModal uzywa CSS variables (nie bg-white)
- GroupFormModal ma walidacje URL (facebook.com/groups/)
  </verify>
  <done>Strona groups/ dziala z real API: tabela z sekcjami per deweloper, modal dodawania/edycji, toggle status, soft delete z potwierdzeniem, filtry developer+status. Usuniety mock data.</done>
</task>

<task type="auto">
  <name>Task 2: GroupBulkUpload + BulkActionToolbar</name>
  <files>
    src/components/fb/GroupBulkUpload.tsx
    src/components/fb/BulkActionToolbar.tsx
  </files>
  <action>
**1. GroupBulkUpload.tsx — Upload pliku z URL-ami**

Props:
```typescript
interface GroupBulkUploadProps {
  developers: string[];
  onComplete: () => void;   // refresh po uloadzie
  onClose: () => void;
}
```

Implementacja:
- Modal wzorzec (fixed inset-0 z-50, CSS variables)
- Dwa sposoby inputu:
  1. **Textarea**: wklej URL-e (jeden per linia) — domyslny
  2. **File input**: wybierz plik .txt z URL-ami — czyta content via FileReader
- Pole dewelopera (text input z datalist autosuggest — jak w GroupFormModal)
- Przycisk "Parsuj URL-e" -> walidacja client-side (regex facebook.com/groups/):
  - Pokaz wynik: "X poprawnych, Y blednych"
  - Lista blednych URL-ow z numerem linii (jesli sa)
  - Mozliwosc kontynuacji z samymi poprawnymi
- Przycisk "Dodaj grupy" -> POST /api/fb-groups z `{ urls: validUrls, developer }`
- Wyswietl wynik: "Dodano X grup" + ewentualne bledy z API
- Limit: max 100 URL-ow (walidacja client-side)
- Loading state podczas POST

**2. BulkActionToolbar.tsx — Toolbar z bulk actions**

Props:
```typescript
interface BulkActionToolbarProps {
  selectedCount: number;
  developers: string[];
  onAction: (action: 'set_status' | 'set_developer' | 'soft_delete', value?: string) => Promise<void>;
  onClearSelection: () => void;
}
```

Implementacja:
- Pasek nad tabela, widoczny TYLKO gdy selectedCount > 0
- Tlo: lekko wyrozniajace sie (`--bg-secondary` z border)
- Tekst: "Zaznaczono X grup"
- Przyciski:
  1. **Aktywuj** (Play) — `onAction('set_status', 'active')`
  2. **Wstrzymaj** (Pause) — `onAction('set_status', 'paused')`
  3. **Zmien dewelopera** — dropdown/select z lista developers + custom input, po wyborze `onAction('set_developer', value)`
  4. **Usun** (Trash2, czerwony) — `confirm()` + `onAction('soft_delete')`
  5. **Odznacz** (X) — `onClearSelection()`
- Dropdown dewelopera: prosty `<select>` z opcja "Wpisz..." ktora zamienia select na text input (lub uzyj datalist)
- Stylowanie: CSS variables, lucide-react ikony, kompaktowy layout (flex row gap-2)
- Loading state: disable buttons podczas operacji

**Integracja z groups/page.tsx:**
Upewnij sie ze groups/page.tsx importuje i renderuje oba komponenty:
- `<GroupBulkUpload>` w modalu (widoczny gdy `showBulkUpload === true`)
- `<BulkActionToolbar>` nad tabela (widoczny gdy `selectedIds.size > 0`)

Jesli groups/page.tsx nie importuje jeszcze tych komponentow z Task 1, dodaj importy i logike renderowania.
  </action>
  <verify>
`npx tsc --noEmit` — zero bledow. Sprawdz ze:
- GroupBulkUpload waliduje URL-e client-side
- GroupBulkUpload limituje do 100 URL-ow
- BulkActionToolbar wyswietla sie tylko gdy selectedCount > 0
- BulkActionToolbar uzywa confirm() przed soft_delete
- Oba komponenty uzywaja CSS variables
  </verify>
  <done>GroupBulkUpload obsluguje textarea + file upload z walidacja URL-ow. BulkActionToolbar oferuje 4 akcje bulk (aktywuj, wstrzymaj, zmien dewelopera, usun). Oba zintegrowane z groups/page.tsx.</done>
</task>

</tasks>

<verification>
- [ ] groups/page.tsx nie uzywa mock data — pobiera z /api/fb-groups
- [ ] Tabela ma sekcje per deweloper z naglowkami
- [ ] Modal dodawania/edycji ma 4 pola (nazwa, URL, deweloper, instrukcja AI)
- [ ] Deweloper ma autosuggest (datalist)
- [ ] Bulk upload waliduje URL-e i limituje do 100
- [ ] Bulk toolbar pojawia sie po zaznaczeniu checkboxow
- [ ] Status toggle dziala (active <-> paused)
- [ ] Soft delete z potwierdzeniem (confirm dialog)
- [ ] Wstrzymane grupy sa wizualnie oznaczone
- [ ] CSS variables wszedzie (zero hardcoded bg-white/text-slate)
- [ ] `npx tsc --noEmit` przechodzi
</verification>

<success_criteria>
1. Admin moze dodac grupe (single + bulk upload), edytowac w modalu, soft-deletowac
2. Tabela grupuje per deweloper, pokazuje metadane (status, posty, scrape)
3. Bulk operations (status, developer, delete) dzialaja na zaznaczonych grupach
4. Wstrzymane grupy wizualnie wyrozniajace sie
</success_criteria>

<output>
After completion, create `.planning/phases/08-group-management/08-03-SUMMARY.md`
</output>
