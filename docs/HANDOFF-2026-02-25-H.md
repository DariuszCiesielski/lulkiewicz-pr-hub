# Handoff: FB Reports & Export (Phase 12) — Context Window Exhausted

**Date:** 2026-02-25
**Reason:** context window exhausted mid-execution
**Design doc:** `docs/plans/2026-02-25-fb-reports-design.md`
**Implementation plan:** `docs/plans/2026-02-25-fb-reports-plan.md`

## Status: 6/8 tasków DONE

| Task | Status | Commit |
|------|--------|--------|
| 1. DB Migration `fb_report_sections` | ✅ DONE | `aebc34f` |
| 2. FB Report Synthesizer (4 AI functions) | ✅ DONE | `314eea5` |
| 3. API POST+GET `/api/fb-reports` | ✅ DONE | `3ec93ea` |
| 4. API POST `/api/fb-reports/process` (polling) | ✅ DONE | `30873ac` |
| 5. API GET/PATCH/DELETE `/api/fb-reports/[id]` | ✅ DONE | `74e9d8b` |
| 6. Frontend — Reports list page | ✅ DONE | `09a7ce7` |
| 7. Frontend — Report detail page | ❌ TODO | — |
| 8. Integration verification | ❌ TODO | — |

## Co zostało do zrobienia

### Task 7: Report Detail Page (PRIORYTET)

Utworzyć `src/app/(hub)/fb-analyzer/reports/[id]/page.tsx`

**Wzorzec:** Skopiuj `src/app/(hub)/email-analyzer/reports/[id]/page.tsx` (462 linie) i zaadaptuj:

**Zmiany vs email:**
- Back link: `/fb-analyzer/reports` (nie `/email-analyzer/reports`)
- API: `/api/fb-reports/${reportId}` (nie `/api/reports/${reportId}`)
- Brak `mailbox` info w headerze — zamiast tego developer name z `report.summary_data.developer`
- Brak badge'ów `template_type` / `detail_level` (FB nie ma tych wariantów)
- Badge: developer name + groups count (`report.group_ids?.length`)
- DOCX export: reuse `exportReportToDocx()` z `@/lib/export/export-report-docx` — działa as-is

**Elementy:**
- Header z tytułem, developer, zakres dat, data utworzenia
- Przyciski: "Pobierz .docx", "Kopiuj raport", "Powrót do raportów"
- Spis treści (collapsible)
- Sekcje z ReactMarkdown + remarkGfm
- Edycja inline per sekcja (Edit → textarea → Save/Cancel)
- `report-content` CSS styles (identyczne jak w email)

### Task 8: Integration Verification

- Uruchom migrację SQL w Supabase Dashboard (z `supabase/migrations/20260225_fb_report_sections.sql`)
- Uruchom dev server (`npm run dev`)
- Przetestuj pełny flow: lista → generuj → polling → detail → edit → export → delete
- Edge cases: deweloper bez postów, pusty zakres dat, wszystkie grupy excluded

## Kluczowe pliki (do reference)

| Plik | Rola |
|------|------|
| `src/lib/ai/fb-report-synthesizer.ts` | 4 funkcje AI syntezy (NEW) |
| `src/app/api/fb-reports/route.ts` | POST create + GET list (NEW) |
| `src/app/api/fb-reports/process/route.ts` | Polling AI synthesis (NEW) |
| `src/app/api/fb-reports/[id]/route.ts` | GET/PATCH/DELETE detail (NEW) |
| `src/app/(hub)/fb-analyzer/reports/page.tsx` | Lista raportów + generator (REWRITTEN) |
| `src/app/(hub)/email-analyzer/reports/[id]/page.tsx` | **WZORZEC** dla Task 7 |
| `src/lib/export/export-report-docx.ts` | DOCX export — reuse as-is |

## Ważne konteksty

- Supabase CLI jest broken → migracje przez Dashboard
- `getAdminClient()` NIGDY na top-level (Vercel crash)
- FB moduł używa `verifyAdmin()` (nie `verifyScopedAdminAccess()`)
- CSS variables w inline `style={{}}`, Tailwind tylko do layoutu
- Polskie komunikaty błędów, angielski kod
